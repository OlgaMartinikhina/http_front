!function(){"use strict";function e(e,n){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw s}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.ticketsList=document.querySelector("#ticket_list")}var r,i,o;return r=t,(i=[{key:"newDesk",value:function(t){this.ticketsList.innerHTML="";var n,r=e(t);try{for(r.s();!(n=r.n()).done;){var i=n.value,o=new Date(i.created),s=this.convertDate(o.getDate()),a=this.convertDate(o.getMonth()+1),c=this.convertDate(o.getFullYear()),u=this.convertDate(o.getHours()),l=this.convertDate(o.getMinutes()),d="".concat(s,".").concat(a,".").concat(c," ").concat(u,":").concat(l),p=document.createElement("div");p.className="ticket_item",p.dataset.id=i.id,p.innerHTML='\n      <div class="div-status"><span class="circle"></span></div>\n      <div class="td-name">'.concat(i.name,'\n      </div>\n      <div class="td-created">').concat(d,'</div>\n      <div class="change-del">\n        <span class="edit-ticket circle"></span>\n        <span class="del-ticket circle"></span>\n      </div>\n      '),this.ticketsList.appendChild(p)}}catch(e){r.e(e)}finally{r.f()}}},{key:"convertDate",value:function(e){return e<10?"0".concat(e):e}}])&&n(r.prototype,i),o&&n(r,o),t}();function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.elPopup=document.createElement("div"),this.sProduct=""}var t,n,r;return t=e,(n=[{key:"htmlElement",get:function(){return'\n        <p id="title-popup">Добавить тикет</p>\n        <p>Краткое описание</p>\n        <input type="text" id="name" class="input" value="">\n        <p>Подробное описание</p>\n        <input type="text" id="description" class="input" value="">\n        <div class="buttons">\n          <div id="cancel" class="button">Отмена</div>\n          <div id="ok" class="button">ОК</div>\n        </div>\n      '}},{key:"addErrorElement",value:function(e){var t=document.createElement("div");t.id="form-error",t.className="form-error hidden",t.textContent="Error",e.appendChild(t)}},{key:"saveProduct",value:function(e){this.sProduct=e}},{key:"bindToDOM",value:function(){this.elPopup.id="popup",this.elPopup.className="popup hidden",this.elPopup.innerHTML=this.htmlElement,this.addErrorElement(this.elPopup),this.parentEl.appendChild(this.elPopup),this.constants(),this.eventsPopup()}},{key:"showPopup",value:function(){this.selectPopup.classList.remove("hidden"),this.selectPopup.style.top="".concat((window.innerHeight-this.selectPopup.offsetHeight)/2,"px"),this.selectPopup.style.left="".concat((window.innerWidth-this.selectPopup.offsetWidth)/2,"px")}},{key:"constants",value:function(){this.selectPopup=document.querySelector("#popup"),this.inputName=document.querySelector("#name"),this.inputDescription=document.querySelector("#description"),this.btnSave=document.getElementById("ok"),this.btnCancel=document.getElementById("cancel"),this.elError=document.querySelector("#form-error")}},{key:"eventsPopup",value:function(){var e=this;this.btnSave.addEventListener("click",(function(){if(""===e.inputName.value)return e.inputName.focus(),void e.showError(e.inputName,"Введите текст!");e.selectPopup.classList.add("hidden"),e.sProduct(),e.clearInput()})),this.btnCancel.addEventListener("click",(function(){e.selectPopup.classList.add("hidden"),e.hidenError(),e.clearInput()})),this.inputName.addEventListener("input",(function(){e.hidenError()}))}},{key:"hidenError",value:function(){this.elError.classList.contains("hidden")||this.elError.classList.add("hidden")}},{key:"clearInput",value:function(){this.inputName.value="",this.inputDescription.value=""}},{key:"showError",value:function(e,t){this.elError.textContent=t,this.elError.classList.remove("hidden"),this.elError.style.top="".concat(e.offsetTop+e.offsetHeight,"px"),this.elError.style.left="".concat(e.offsetLeft+(e.offsetWidth-this.elError.offsetWidth)/2,"px")}}])&&i(t.prototype,n),r&&i(t,r),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"init",value:function(){var e=document.createElement("div");e.id="confirm-del",e.className="popup hidden",e.innerHTML='\n      <p>Удалить тикет?</p>\n      <p>Вы уверены, что хотите удалить тикет? Это действие необратимо.</p>\n      <div class="buttons">\n        <div id="cancel-del" class="button">Отмена</div>\n        <div id="ok-del" class="button">ОК</div>\n      </div>\n      ',document.body.appendChild(e),this.formDel=document.getElementById("confirm-del"),this.okDel=document.getElementById("ok-del"),this.cancelDel=document.getElementById("cancel-del")}},{key:"delElemListener",value:function(e){this.formDel.classList.add("hidden"),e(),this.okDel.removeEventListener("click",this.boundedFunc)}},{key:"delElement",value:function(e){var t=this;this.formDel.classList.remove("hidden"),this.formDel.style.top="".concat((window.innerHeight-this.formDel.offsetHeight)/2,"px"),this.formDel.style.left="".concat((window.innerWidth-this.formDel.offsetWidth)/2,"px"),this.boundedFunc=this.delElemListener.bind(this,e),this.okDel.addEventListener("click",this.boundedFunc),this.cancelDel.addEventListener("click",(function(){t.formDel.classList.add("hidden")}))}}])&&s(t.prototype,n),r&&s(t,r),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u="https://coursar-herolu.herokuapp.com/",l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"addTicket",value:function(e,t){return new Promise((function(n){var r=new URLSearchParams;r.append("name",e),r.append("description",t);var i=new XMLHttpRequest;i.open("POST","".concat(u,"/")),i.addEventListener("load",(function(){return 200===i.status?n(i.responseText):(console.log(i.responseText),i.responseText)})),i.send(r)}))}},{key:"getTickets",value:function(){return new Promise((function(e){var t=new XMLHttpRequest;t.open("GET","".concat(u,"/?method=allTickets")),t.addEventListener("load",(function(){if(200===t.status){var n=JSON.parse(t.responseText);return e(n)}return console.log(t.responseText),t.responseText})),t.send()}))}},{key:"changeTickets",value:function(e,t,n){return new Promise((function(r){var i=new URLSearchParams;i.append("id",e),i.append("name",t),i.append("description",n);var o=new XMLHttpRequest;o.open("PUT","".concat(u,"/")),o.addEventListener("load",(function(){return 200===o.status?r(o.responseText):(console.log(o.responseText),o.responseText)})),o.send(i)}))}},{key:"getDescription",value:function(e){return new Promise((function(t){var n=new URLSearchParams;n.append("id",e),n.append("method","ticketById");var r=new XMLHttpRequest;r.open("GET","".concat(u,"/?").concat(n)),r.addEventListener("load",(function(){if(200===r.status){var e=JSON.parse(r.responseText);return t(e.description)}return console.log(r.responseText),r.responseText})),r.send()}))}},{key:"delTicket",value:function(e){return new Promise((function(t){var n=new URLSearchParams;n.append("id",e);var r=new XMLHttpRequest;r.open("DELETE","".concat(u,"/?").concat(n)),r.addEventListener("load",(function(){if(200===r.status){var e=r.responseText;return t(e)}return console.log(r.responseText),r.responseText})),r.send()}))}},{key:"changeStatus",value:function(e,t){return new Promise((function(n){var r=new URLSearchParams;r.append("id",e),r.append("status",t);var i=new XMLHttpRequest;i.open("PATCH","".concat(u,"/?").concat(r)),i.addEventListener("load",(function(){if(200===i.status){var e=i.responseText;return n(e)}return console.log(i.responseText),i.responseText})),i.send()}))}}])&&c(t.prototype,n),r&&c(t,r),e}();function d(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){d(o,r,i,s,a,"next",e)}function a(e){d(o,r,i,s,a,"throw",e)}s(void 0)}))}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=new r,v=new o(document.body),m=new a,y=new l;(new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tableGoods=document.querySelector("#ticket_list"),this.elAddProduct=document.querySelector("#add-ticket"),this.id=null,this.itemIndex=null}var t,n,r,i,o,s;return t=e,(n=[{key:"init",value:(s=p(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getTickets();case 2:t=e.sent,h.redrawGoods(t),v.bindToDOM(),v.saveProduct(this.saveProduct.bind(this)),this.inputName=document.querySelector("#name"),this.inputDescription=document.querySelector("#description"),this.popupTitle=document.querySelector("#title-popup"),m.init(),this.eventsGoods();case 11:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"eventsGoods",value:function(){var e=this;this.tableGoods.addEventListener("click",function(){var t=p(regeneratorRuntime.mark((function t(n){var r,i,o,s,a,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.target.classList,e.id=n.target.closest(".ticket_item").dataset.id,!r.contains("edit-ticket")){t.next=11;break}return i=n.target.closest(".ticket_item").querySelector(".td-name").innerText,t.next=6,y.getDescription(e.id);case 6:o=t.sent,e.inputName.value=i,e.inputDescription.value=o,e.popupTitle.innerText="Изменить тикет",v.showPopup();case 11:if(r.contains("del-ticket")&&m.delElement(e.delProduct.bind(e)),!r.contains("td-name")){t.next=25;break}if(s=n.target.parentNode.querySelector(".description")){t.next=24;break}return t.next=17,y.getDescription(e.id);case 17:a=t.sent,(c=document.createElement("div")).className="description",c.innerHTML="\n          <p>".concat(a,"</p>\n          "),n.target.parentNode.appendChild(c),t.next=25;break;case 24:s.classList.toggle("hidden");case 25:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.elAddProduct.addEventListener("click",(function(){e.id=null,e.popupTitle.innerText="Добавить тикет",v.showPopup()}))}},{key:"delProduct",value:(o=p(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.delTicket(this.id);case 2:return e.next=4,y.getTickets();case 4:t=e.sent,h.newDesk(t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"saveProduct",value:(i=p(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this.id){e.next=5;break}return e.next=3,y.changeTickets(this.id,this.inputName.value,this.inputDescription.value);case 3:e.next=7;break;case 5:return e.next=7,y.addTicket(this.inputName.value,this.inputDescription.value);case 7:return e.next=9,y.getTickets();case 9:t=e.sent,h.newDesk(t);case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}])&&f(t.prototype,n),r&&f(t,r),e}())).init()}();